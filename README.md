# Лабораторная работа №8  
## Настройка непрерывной интеграции с помощью GitHub Actions

---

### Цель работы

Изучение принципов настройки процесса непрерывной интеграции (CI) с использованием GitHub Actions на основе PHP-приложения, запускаемого в Docker-контейнере, с реализацией юнит-тестов.

---

### Задание

1. Создать PHP Web-приложение с использованием SQLite.
2. Реализовать модульную структуру кода.
3. Написать собственный тестовый фреймворк и юнит-тесты.
4. Настроить GitHub Actions для выполнения CI:
   - сборка контейнера;
   - инициализация БД;
   - запуск тестов внутри контейнера.

---

### Ход работы

#### 1. Создание проекта

Создан новый репозиторий `containers08` и склонирован на локальную машину.

#### 2. Структура проекта

Проект разделён на директории:

- `site/` — PHP-приложение;
- `tests/` — тестовый фреймворк и тесты;
- `sql/` — SQL-скрипт с таблицей и начальными данными;
- `Dockerfile` — конфигурация контейнера;
- `.github/workflows/main.yml` — GitHub Actions workflow.

#### 3. Основные файлы

- `index.php` — главная точка входа в приложение.
- `config.php` — содержит путь к SQLite-базе.
- `modules/database.php` — класс Database с CRUD-методами.
- `modules/page.php` — класс Page для отрисовки HTML на основе шаблонов.
- `templates/index.tpl` — шаблон для отображения страницы.
- `tests/testframework.php` — самописный тестовый фреймворк.
- `tests/tests.php` — юнит-тесты всех методов классов.

#### 4. Реализация тестирования

Тесты проверяют работу методов:
- Create, Read, Update, Delete в классе Database;
- работу шаблонизатора Page.

Пример теста:
```php
function testCreateAndRead() {
    global $config;
    $db = new Database($config["db"]["path"]);
    $id = $db->Create("page", ["title" => "Test", "content" => "Hello"]);
    $item = $db->Read("page", $id);
    return assertExpression($item["title"] == "Test", "Title is correct", "Title mismatch");
}
```

#### 5. Dockerfile

В `Dockerfile`:
- устанавливается PHP 7.4 и SQLite;
- копируются исходные файлы и инициализируется БД;
- задаётся команда для запуска тестов.

#### 6. GitHub Actions

Создан файл `.github/workflows/main.yml`, который выполняет:

- запуск контейнера;
- выполнение `tests.php` внутри контейнера;
- проверку результатов тестирования;
- удаление контейнера.

---

### Результаты

Все тесты успешно прошли. CI-процесс запускается автоматически при каждом коммите или Pull Request'е, что подтверждается вкладкой "Actions" на GitHub.

---

### Ответы на вопросы

**1. Что такое непрерывная интеграция (CI)?**  
Это процесс автоматической сборки и тестирования проекта каждый раз, когда в него вносятся изменения. Это позволяет быстро выявлять ошибки и ускоряет разработку.

**2. Для чего нужны юнит-тесты и как часто их следует запускать?**  
Юнит-тесты проверяют корректность работы отдельных компонентов. Их нужно запускать при каждом изменении в проекте, особенно перед слиянием веток.

**3. Что нужно изменить в `.github/workflows/main.yml`, чтобы тесты запускались при Pull Request?**  
Добавить:
```yaml
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
```

**4. Что нужно изменить в `main.yml`, чтобы удалять Docker-образ после тестов?**  
Добавить шаг:
```yaml
- name: Remove Docker image
  run: docker rmi containers08
```

---

### Выводы

В процессе выполнения лабораторной работы:

- создано и структурировано PHP-приложение;
- реализована работа с SQLite и шаблонами;
- написаны и выполнены юнит-тесты;
- настроен GitHub Actions для автоматического запуска тестов;
- получены практические навыки CI/CD с использованием Docker и GitHub Actions.
